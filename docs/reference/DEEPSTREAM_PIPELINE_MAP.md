# DeepStream Video Pipeline: Stream to WebSocket Map

## Overview
This document provides a comprehensive visual mapping of the DeepStream video processing pipeline from RTSP stream input to WebSocket output, showing the current implementation status and data flow.

## Pipeline Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    DEEPSTREAM VIDEO PIPELINE MAP                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           INPUT LAYER                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RTSP Streams (config.py):
â”œâ”€â”€ Living Room Camera: rtsp://192.168.3.214:7447/jdr9oLlBkjyl3gDm? (1920x1080) âœ… ENABLED
â”œâ”€â”€ Kitchen Camera: rtsp://192.168.3.214:7447/qt3VqVdZpgG1B4Vk? (1920x1080) âŒ DISABLED  
â””â”€â”€ Family Room Camera: rtsp://192.168.3.214:7447/4qWTBhW6b4nLeUFE? (1280x720) âŒ DISABLED

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        DEEPSTREAM PIPELINE LAYER                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

deepstream_video_pipeline.py:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SOURCE BIN CREATION                                                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nvurisrcbin (per source) - DeepStream's unified source element that handles RTSP, file, and camera inputs with automatic demuxing, decoding, and format conversion to GPU memory.                                                                                    â”‚
â”‚ â”œâ”€â”€ URI: rtsp://192.168.3.214:7447/jdr9oLlBkjyl3gDm?                                                       â”‚
â”‚ â”œâ”€â”€ GPU-ID: 0                                                                                               â”‚
â”‚ â”œâ”€â”€ CUDA Memory Type: Device Memory (0)                                                                     â”‚
â”‚ â”œâ”€â”€ RTSP Properties:                                                                                        â”‚
â”‚ â”‚   â”œâ”€â”€ drop-on-latency: True                                                                               â”‚
â”‚ â”‚   â”œâ”€â”€ latency: 50ms (config.processing.DEEPSTREAM_SOURCE_LATENCY)                                         â”‚
â”‚ â”‚   â””â”€â”€ protocols: TCP only (4)                                                                             â”‚
â”‚ â””â”€â”€ Dynamic Pad Creation:                                                                                   â”‚
â”‚     â”œâ”€â”€ pad-added signal â†’ cb_newpad()                                                                      â”‚
â”‚     â””â”€â”€ child-added signal â†’ decodebin_child_added()                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STREAM MULTIPLEXING                                                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nvstreammux - DeepStream's batch multiplexer that combines multiple video streams into a single batch for efficient GPU processing, handling padding, scaling, and memory management.                                                                                                 â”‚
â”‚ â”œâ”€â”€ batch-size: 1 (auto-calculated from enabled streams)                                                    â”‚
â”‚ â”œâ”€â”€ width: 1280 (config.processing.DEEPSTREAM_MUX_SCALE_MODE=2)                                            â”‚
â”‚ â”œâ”€â”€ height: 720 (config.processing.DEEPSTREAM_MUX_SCALE_MODE=2)                                             â”‚
â”‚ â”œâ”€â”€ batched-push-timeout: 4000000ms                                                                         â”‚
â”‚ â”œâ”€â”€ gpu-id: 0                                                                                               â”‚
â”‚ â”œâ”€â”€ nvbuf-memory-type: 0 (CUDA device memory)                                                               â”‚
â”‚ â”œâ”€â”€ enable-padding: 1                                                                                       â”‚
â”‚ â”œâ”€â”€ live-source: 1 (for RTSP streams)                                                                       â”‚
â”‚ â”œâ”€â”€ sync-inputs: 0 (disable input synchronization for better batch performance)                              â”‚
â”‚ â””â”€â”€ drop-pipeline-eos: 1 (drop EOS events to prevent pipeline stalls)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GPU PREPROCESSING                                                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nvdspreprocess - DeepStream's GPU-accelerated preprocessing element that handles tensor preparation for inference.                                                                                                                          â”‚
â”‚ â”œâ”€â”€ config-file: config_preproc.txt                                                                         â”‚
â”‚ â”œâ”€â”€ gpu-id: 0                                                                                               â”‚
â”‚ â”œâ”€â”€ enable: True                                                                                            â”‚
â”‚ â”œâ”€â”€ process-on-frame: True                                                                                  â”‚
â”‚ â”œâ”€â”€ output-frame-meta: True                                                                                 â”‚
â”‚ â”œâ”€â”€ output-tensor-meta: True                                                                                â”‚
â”‚ â”œâ”€â”€ network-input-shape: 1;3;640;640                                                                        â”‚
â”‚ â”œâ”€â”€ processing-width: 640                                                                                   â”‚
â”‚ â”œâ”€â”€ processing-height: 640                                                                                  â”‚
â”‚ â”œâ”€â”€ network-color-format: 0 (RGB)                                                                           â”‚
â”‚ â”œâ”€â”€ tensor-data-type: 0 (FLOAT32)                                                                           â”‚
â”‚ â”œâ”€â”€ custom-lib-path: /opt/nvidia/deepstream/deepstream/lib/gst-plugins/libcustom2d_preprocess.so            â”‚
â”‚ â””â”€â”€ custom-tensor-preparation-function: CustomTensorPreparation                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INFERENCE & TRACKING                                                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nvinfer (Primary GIE) - DeepStream's GPU inference engine that runs TensorRT models with custom parsers, providing hardware-accelerated AI inference with metadata extraction.                                                                                                   â”‚
â”‚ â”œâ”€â”€ config-file-path: config_infer_primary_yolo11.txt                                                       â”‚
â”‚ â”œâ”€â”€ YOLO-11 Custom Parser: libnvdsparsebbox_yolo11.so                                                       â”‚
â”‚ â”œâ”€â”€ input-tensor-meta: True                                                                                 â”‚
â”‚ â”œâ”€â”€ output-tensor-meta: True                                                                                â”‚
â”‚ â””â”€â”€ Pad Probe: _nvinfer_src_pad_buffer_probe()                                                              â”‚
â”‚                                                                                                             â”‚
â”‚ nvtracker - DeepStream's object tracking element that maintains object identities across frames using algorithms like NvDCF, providing persistent tracking metadata.                                                                                        â”‚
â”‚ â”œâ”€â”€ ll-config-file: config_tracker_nvdcf_batch.yml                                                         â”‚
â”‚ â”œâ”€â”€ ll-lib-file: libnvds_nvmultiobjecttracker.so                                                            â”‚
â”‚ â”œâ”€â”€ tracker-width: 640                                                                                      â”‚
â”‚ â”œâ”€â”€ tracker-height: 384                                                                                     â”‚
â”‚ â”œâ”€â”€ gpu-id: 0                                                                                               â”‚
â”‚ â””â”€â”€ tracking-id-reset-mode: 0 (Never reset tracking ID)                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ANALYTICS PROCESSING                                                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nvdsanalytics - DeepStream's analytics element that provides advanced video analytics capabilities including ROI filtering, line crossing, direction detection, and overcrowding analysis.                                                                                    â”‚
â”‚ â”œâ”€â”€ config-file: config_nvdsanalytics.txt                                                                   â”‚
â”‚ â”œâ”€â”€ enable: 1                                                                                               â”‚
â”‚ â”œâ”€â”€ config-width: 1280                                                                                      â”‚
â”‚ â”œâ”€â”€ config-height: 720                                                                                      â”‚
â”‚ â”œâ”€â”€ osd-mode: 2 (all info display)                                                                          â”‚
â”‚ â”œâ”€â”€ display-font-size: 12                                                                                   â”‚
â”‚ â”œâ”€â”€ ROI Filtering: Center area (320;180;960;180;960;540;320;540)                                           â”‚
â”‚ â”œâ”€â”€ Line Crossing: Entry line (100;360;1180;360)                                                            â”‚
â”‚ â”œâ”€â”€ Direction Detection: North, South, East, West vectors                                                   â”‚
â”‚ â”œâ”€â”€ Overcrowding: Threshold 5 objects in full frame ROI                                                     â”‚
â”‚ â””â”€â”€ Pad Probe: _analytics_probe()                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VISUALIZATION & OUTPUT                                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nvvideoconvert - DeepStream's GPU-accelerated video format converter that transforms video formats and color spaces for display and processing, maintaining GPU memory efficiency.                                                                                              â”‚
â”‚ â”œâ”€â”€ gpu-id: 0                                                                                               â”‚
â”‚ â””â”€â”€ Format conversion for display                                                                           â”‚
â”‚                                                                                                             â”‚
â”‚ nvdsosd - DeepStream's on-screen display element that overlays bounding boxes, labels, and tracking information directly on video frames using GPU rendering.                                                                                          â”‚
â”‚ â”œâ”€â”€ gpu-id: 0                                                                                               â”‚
â”‚ â””â”€â”€ On-screen display for visualization                                                                     â”‚
â”‚                                                                                                             â”‚
â”‚ Conditional Output Paths:                                                                                   â”‚
â”‚ â”œâ”€â”€ Native OSD Mode (USE_NATIVE_DEEPSTREAM_OSD=True):                                                       â”‚
â”‚ â”‚   â”œâ”€â”€ nvvideoconvert_post â†’ nvjpegenc â†’ appsink_jpeg                                                      â”‚
â”‚ â”‚   â””â”€â”€ GPU-encoded JPEG bytes for direct WebSocket streaming                                               â”‚
â”‚ â””â”€â”€ Python OSD Mode (USE_NATIVE_DEEPSTREAM_OSD=False):                                                      â”‚
â”‚     â”œâ”€â”€ appsink (classic)                                                                                   â”‚
â”‚     â”œâ”€â”€ emit-signals: True                                                                                  â”‚
â”‚     â”œâ”€â”€ max-buffers: 1                                                                                      â”‚
â”‚     â”œâ”€â”€ drop: True                                                                                          â”‚
â”‚     â”œâ”€â”€ sync: False                                                                                         â”‚
â”‚     â””â”€â”€ new-sample signal â†’ _on_new_sample()                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TENSOR EXTRACTION (Zero-Copy GPU)                                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _on_new_sample() Processing:                                                                                â”‚
â”‚ â”œâ”€â”€ Batch Metadata: pyds.gst_buffer_get_nvds_batch_meta()                                                  â”‚
â”‚ â”œâ”€â”€ Tensor Extraction:                                                                                      â”‚
â”‚ â”‚   â”œâ”€â”€ NvDsPreProcessBatchMeta (type 27) - Custom preprocessing metadata                                  â”‚
â”‚ â”‚   â”œâ”€â”€ NvDsPreProcessTensorMeta                                                                           â”‚
â”‚ â”‚   â”œâ”€â”€ CuPy Zero-Copy: cp.cuda.UnownedMemory()                                                            â”‚
â”‚ â”‚   â””â”€â”€ PyTorch Tensor: torch.utils.dlpack.from_dlpack()                                                   â”‚
â”‚ â”œâ”€â”€ Shape Handling:                                                                                         â”‚
â”‚ â”‚   â”œâ”€â”€ NCHW (order=0): (n, c, h, w)                                                                       â”‚
â”‚ â”‚   â””â”€â”€ NHWC (order=1): (n, h, w, c) â†’ permute(0, 3, 1, 2)                                                â”‚
â”‚ â”œâ”€â”€ Fallback Tensor Extraction:                                                                             â”‚
â”‚ â”‚   â”œâ”€â”€ NvDsInferTensorMeta (type 12) - Inference metadata                                                 â”‚
â”‚ â”‚   â””â”€â”€ Same zero-copy GPU tensor extraction process                                                        â”‚
â”‚ â””â”€â”€ Queue Output: tensor_queue.put()                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        UNIFIED GPU PIPELINE LAYER                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

main.py (DeepStreamProcessorWrapper):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PIPELINE LOOP                                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _processing_loop()                                                                                          â”‚
â”‚ â”œâ”€â”€ Stage 1: DeepStream Read                                                                                â”‚
â”‚ â”‚   â”œâ”€â”€ deepstream_processor.read_gpu_tensor()                                                             â”‚
â”‚ â”‚   â”œâ”€â”€ GPU Tensor Validation                                                                               â”‚
â”‚ â”‚   â””â”€â”€ Performance Optimization (if enabled)                                                               â”‚
â”‚ â”‚                                                                                                           â”‚
â”‚ â”œâ”€â”€ Stage 2: DeepStream Preprocessing (Integrated)                                                          â”‚
â”‚ â”‚   â”œâ”€â”€ No additional preprocessing needed                                                                  â”‚
â”‚ â”‚   â””â”€â”€ Use DeepStream preprocessed tensor directly                                                         â”‚
â”‚ â”‚                                                                                                           â”‚
â”‚ â”œâ”€â”€ Stage 3: TensorRT Inference                                                                             â”‚
â”‚ â”‚   â”œâ”€â”€ _process_tensor_gpu_only()                                                                          â”‚
â”‚ â”‚   â”œâ”€â”€ GPUOnlyDetectionManager                                                                             â”‚
â”‚ â”‚   â””â”€â”€ TensorRTModelManager (shared)                                                                       â”‚
â”‚ â”‚                                                                                                           â”‚
â”‚ â”œâ”€â”€ Stage 4: Tracking (Optional)                                                                            â”‚
â”‚ â”‚   â”œâ”€â”€ TrackingSystem.update()                                                                             â”‚
â”‚ â”‚   â””â”€â”€ ByteTrack algorithm                                                                                 â”‚
â”‚ â”‚                                                                                                           â”‚
â”‚ â”œâ”€â”€ Stage 5: Visualization Conversion                                                                       â”‚
â”‚ â”‚   â”œâ”€â”€ _tensor_to_numpy_bgr() (ONLY GPUâ†’CPU transfer)                                                     â”‚
â”‚ â”‚   â””â”€â”€ OpenCV format for visualization                                                                     â”‚
â”‚ â”‚                                                                                                           â”‚
â”‚ â””â”€â”€ Stage 6: Analysis Frame Creation                                                                        â”‚
â”‚     â”œâ”€â”€ AnalysisFrame object                                                                                â”‚
â”‚     â”œâ”€â”€ DetectionResult conversion                                                                          â”‚
â”‚     â””â”€â”€ Output to analysis_frame_queue                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        MAIN APPLICATION LAYER                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

main.py (ApplicationManager):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESULT PROCESSING                                                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _start_result_processing()                                                                                  â”‚
â”‚ â”œâ”€â”€ process_results() thread                                                                                â”‚
â”‚ â”œâ”€â”€ analysis_frame_queue.get()                                                                              â”‚
â”‚ â””â”€â”€ _process_analysis_frame()                                                                               â”‚
â”‚                                                                                                             â”‚
â”‚ _process_analysis_frame():                                                                                  â”‚
â”‚ â”œâ”€â”€ Visualization:                                                                                          â”‚
â”‚ â”‚   â”œâ”€â”€ visualization_manager.annotate_frame()                                                             â”‚
â”‚ â”‚   â”œâ”€â”€ Detection boxes, tracking boxes, traces                                                            â”‚
â”‚ â”‚   â”œâ”€â”€ Keypoints, masks, labels                                                                            â”‚
â”‚ â”‚   â””â”€â”€ Performance profiling (if enabled)                                                                  â”‚
â”‚ â”‚                                                                                                           â”‚
â”‚ â”œâ”€â”€ Frame Encoding:                                                                                         â”‚
â”‚ â”‚   â”œâ”€â”€ cv2.imencode('.jpg', annotated_frame, [cv2.IMWRITE_JPEG_QUALITY, 85])                             â”‚
â”‚ â”‚   â””â”€â”€ JPEG compression for WebSocket                                                                      â”‚
â”‚ â”‚                                                                                                           â”‚
â”‚ â”œâ”€â”€ Binary Message Construction:                                                                            â”‚
â”‚ â”‚   â”œâ”€â”€ camera_id_bytes = analysis_frame.camera_id.encode('utf-8')                                        â”‚
â”‚ â”‚   â”œâ”€â”€ camera_id_length = len(camera_id_bytes)                                                            â”‚
â”‚ â”‚   â””â”€â”€ binary_message = bytes([camera_id_length]) + camera_id_bytes + jpeg_data                           â”‚
â”‚ â”‚                                                                                                           â”‚
â”‚ â””â”€â”€ WebSocket Broadcasting:                                                                                 â”‚
â”‚     â”œâ”€â”€ websocket_server.broadcast_sync(binary_message)                                                    â”‚
â”‚     â””â”€â”€ Frame saving (if enabled)                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        WEBSOCKET SERVER LAYER                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

websocket_server.py (WebSocketServer):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVER MANAGEMENT                                                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ start()                                                                                                     â”‚
â”‚ â”œâ”€â”€ websockets.serve(handle_client, host, port)                                                            â”‚
â”‚ â”œâ”€â”€ _periodic_stats_broadcast() task                                                                        â”‚
â”‚ â””â”€â”€ Event loop management                                                                                   â”‚
â”‚                                                                                                             â”‚
â”‚ broadcast_sync()                                                                                            â”‚
â”‚ â”œâ”€â”€ asyncio.run_coroutine_threadsafe()                                                                      â”‚
â”‚ â””â”€â”€ broadcast() coroutine                                                                                   â”‚
â”‚                                                                                                             â”‚
â”‚ broadcast()                                                                                                 â”‚
â”‚ â”œâ”€â”€ Message type handling:                                                                                  â”‚
â”‚ â”‚   â”œâ”€â”€ dict â†’ JSON string                                                                                  â”‚
â”‚ â”‚   â”œâ”€â”€ bytes â†’ Binary message                                                                              â”‚
â”‚ â”‚   â””â”€â”€ str â†’ Direct string                                                                                 â”‚
â”‚ â”œâ”€â”€ asyncio.gather() for all clients                                                                        â”‚
â”‚ â””â”€â”€ Error handling per client                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENT HANDLING                                                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ handle_client()                                                                                             â”‚
â”‚ â”œâ”€â”€ Client connection tracking                                                                              â”‚
â”‚ â”œâ”€â”€ Message processing:                                                                                     â”‚
â”‚ â”‚   â”œâ”€â”€ clear_stats command                                                                                 â”‚
â”‚ â”‚   â”œâ”€â”€ set_vis_toggle command                                                                              â”‚
â”‚ â”‚   â””â”€â”€ JSON message parsing                                                                                â”‚
â”‚ â””â”€â”€ Connection lifecycle management                                                                         â”‚
â”‚                                                                                                             â”‚
â”‚ _periodic_stats_broadcast()                                                                                 â”‚
â”‚ â”œâ”€â”€ stats_callback() invocation                                                                             â”‚
â”‚ â”œâ”€â”€ JSON stats message construction                                                                         â”‚
â”‚ â””â”€â”€ Periodic broadcasting (1 second intervals)                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           OUTPUT LAYER                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WebSocket Clients:
â”œâ”€â”€ Binary Frame Messages: [camera_id_length][camera_id][jpeg_data]
â”œâ”€â”€ JSON Stats Messages: Performance metrics, system status
â””â”€â”€ Toggle Update Messages: Visualization control

## Data Flow Summary

### 1. Stream Input
- **Source**: RTSP streams from IP cameras
- **Format**: H.264/H.265 encoded video
- **Resolution**: 1920x1080 (Living Room), 1280x720 (Family Room)
- **Protocol**: RTSP over TCP with 50ms latency

### 2. DeepStream Processing
- **Decoder**: nvurisrcbin with NVIDIA hardware decoder
- **Memory**: CUDA device memory (zero-copy)
- **Batching**: nvstreammux with batch size 1
- **Preprocessing**: nvdspreprocess with custom library
- **Inference**: YOLO-11 with custom parser
- **Tracking**: NvDCF tracker (configurable)
- **Analytics**: nvdsanalytics with ROI, line crossing, direction detection

### 3. Tensor Extraction
- **Method**: Zero-copy GPU tensor extraction
- **Library**: CuPy + PyTorch DLPack
- **Format**: NCHW or NHWC tensors
- **Memory**: GPU memory only (no CPU transfer)
- **Fallback**: Inference metadata if preprocessing metadata unavailable

### 4. Unified Pipeline
- **Processing**: TensorRT inference on GPU
- **Tracking**: ByteTrack algorithm (configurable)
- **Conversion**: Single GPUâ†’CPU transfer for visualization
- **Output**: AnalysisFrame objects

### 5. WebSocket Streaming
- **Format**: Binary messages with JPEG frames
- **Structure**: [camera_id_length][camera_id][jpeg_data]
- **Stats**: JSON messages with performance metrics
- **Control**: Toggle messages for visualization

## Performance Characteristics

### GPU Memory Usage
- **DeepStream**: ~2-4GB for video decoding and preprocessing
- **TensorRT**: ~1-2GB for inference engines
- **Tracking**: ~100-200MB for tracking state
- **Analytics**: ~50-100MB for analytics processing
- **Total**: ~4-6GB peak usage

### Latency
- **RTSP Input**: 50ms latency setting
- **DeepStream Processing**: ~10-30ms per frame
- **TensorRT Inference**: ~5-15ms per frame
- **Analytics**: ~1-5ms per frame
- **WebSocket Output**: ~1-5ms per frame
- **Total Pipeline**: ~20-50ms end-to-end

### Throughput
- **Input**: 30 FPS per camera
- **Processing**: 10-30 FPS depending on model complexity
- **Output**: 20 FPS max (configurable)
- **Multi-camera**: Linear scaling with GPU memory

## Current Status

### âœ… Implemented Components
1. **DeepStream Pipeline**: Complete with YOLO-11 integration
2. **Zero-Copy Tensor Extraction**: Working with CuPy/PyTorch
3. **Native OSD Mode**: GPU-encoded JPEG streaming
4. **Python OSD Mode**: Frame annotation and processing
5. **WebSocket Server**: Binary frame streaming
6. **Multi-camera Support**: Configurable RTSP streams
7. **Performance Monitoring**: Comprehensive metrics
8. **Error Handling**: Robust pipeline management
9. **Analytics Integration**: ROI filtering, line crossing, direction detection
10. **Configurable Tracking**: Native DeepStream vs. Python ByteTrack

### ğŸ”§ Configuration Options
1. **Camera Sources**: RTSP streams with individual settings
2. **Processing Pipeline**: DeepStream + TensorRT
3. **Visualization**: Configurable display options (Native vs. Python)
4. **Tracking**: Configurable tracking options (Native vs. Python)
5. **Performance**: Profiling and optimization settings
6. **Output**: WebSocket streaming and file saving

### ğŸ“Š Monitoring Points
1. **GPU Memory**: Real-time memory usage tracking
2. **Pipeline Performance**: FPS and latency metrics
3. **Error Rates**: Consecutive failure tracking
4. **WebSocket Stats**: Client connections and message rates
5. **System Resources**: CPU and GPU utilization
6. **Analytics Events**: ROI violations, line crossings, overcrowding

## Key Features

### GPU-Only Operation
- **Zero CPU Fallbacks**: All operations must succeed on GPU
- **Memory Efficiency**: Minimal GPUâ†’CPU transfers
- **Performance Optimization**: TensorRT and DeepStream integration

### Real-Time Streaming
- **Low Latency**: <50ms end-to-end processing
- **High Throughput**: 20+ FPS per camera
- **Scalable**: Multi-camera support with linear scaling

### Robust Error Handling
- **Pipeline Recovery**: Automatic restart on failures
- **Resource Management**: GPU memory pool and cleanup
- **Monitoring**: Comprehensive performance tracking

### Flexible Configuration
- **Dynamic Sources**: Enable/disable cameras at runtime
- **Model Selection**: YOLO-11 with custom parser support
- **Visualization Control**: Real-time toggle updates via WebSocket
- **Analytics Configuration**: ROI, line crossing, direction detection

### Advanced Analytics
- **ROI Filtering**: Define regions of interest for object counting
- **Line Crossing**: Detect objects crossing defined lines
- **Direction Detection**: Analyze object movement patterns
- **Overcrowding**: Monitor object density in specified areas

This pipeline represents a complete GPU-accelerated video processing system optimized for real-time multi-camera analysis with minimal latency and maximum throughput, featuring configurable tracking and visualization modes with advanced analytics capabilities. 